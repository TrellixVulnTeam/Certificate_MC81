<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="shortcut icon" type="image/png" href="./img/favicon.png">
    <title>Yutech | Lab5</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="./lib/materialize/css/materialize.min.css"  media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="./css/style5.css"/>

    <style>
        body {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        main {
            flex: 1 0 auto;
            padding-top: 40px;
        }

        footer {
            padding: 10px !important;
        }

        #genCert > div {
            padding: 1rem;
        }

        .brand-logo {
            height: 100%;
            display: flex !important;
        }
        .brand-logo > img {
            height: 100%;
            width: auto;
            padding: 0.5rem;
        }
        
        table input:not(:placeholder-shown) {
            background-color: lightyellow !important;
        }

        table input {
            color: green;
            border: none !important;
        }
        
        table input:focus {
            border: none !important;
            box-shadow: none !important;
        }
        table input:not(.browser-default) {
            border: none !important;
            box-shadow: none !important;
        }

        @media print {
            #main  *, #options-burger *, .navbar-fixed *, .date-picker *, footer * {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper teal darken-1 val">
                <a href="#!" class="brand-logo">
                    <img src="./img/favicon.png" alt="YuTech Logo"  class="hide-on-med-and-down">
                    <span>Yutech</span>
                </a>
                <a href="#" data-target="options-burger" class="sidenav-trigger"><i class="material-icons">menu</i></a>
                <ul id="options" class="right hide-on-med-and-down">
                    
                </ul>
            </div>
        </nav>
    </div>

    <ul id="options-burger" class="sidenav blue-grey darken-4">

    </ul>

    <main class="container" id="main">
        <div id="form" class="row">
            <div class="col s12 center-align teal-text text-darken-4">
                <h5>試穿戴實驗課程(五)證書</h5>
            </div>
            <form class="card-panel col s12" id="genCert">
                <div class="row">
                    <div class="input-field col s12 m6">
                        <i class="material-icons prefix">title</i>
                        <input placeholder="王小明" type="text" class="validate" required id="_a">
                        <label for="_a">姓名</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <i class="material-icons prefix">date_range</i>
                        <input type="text" class="datepicker no-autoinit" required id="_b">
                        <label for="_b">生日</label>
                    </div>
                    
                    <div class="file-field input-field col s12">
                        <div class="btn">
                            <span>自拍照</span>
                            <input type="file"  required id="_c">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text" placeholder="上傳一個檔案">
                            <img id="_c_pic">
                        </div>
                    </div>
                    
                    <div class="file-field input-field col s12">
                        <div class="btn">
                            <span>正常心電訊號</span>
                            <input type="file" required id="_d">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text" placeholder="上傳一個檔案">
                            <img id="_d_pic">
                        </div>
                    </div>

                    <div class="file-field input-field col s12">
                        <div class="btn">
                            <span>心律不整心電訊號</span>
                            <input type="file" required id="_e">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text" placeholder="上傳一個檔案">
                            <img id="_e_pic">
                        </div>
                    </div>

                    <div class="file-field input-field col s12">
                        <div class="btn">
                            <span>model訓練情況圖</span>
                            <input type="file"  required id="_f">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text" placeholder="上傳一個檔案">
                            <img id="_f_pic">
                        </div>
                    </div>

                    <table class="highlight" id="table">
                        <thead>
                            <tr>
                                <th>Layer</th>
                                <th>Output shape</th>
                            </tr>
                        </thead>
                
                        <tbody>
                            <tr>
                                <td>conv1d</td>
                                <td><input placeholder="xxx" id="a" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>leaky_re_lu</td>
                                <td><input placeholder="xxx" id="b" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>conv1d_1</td>
                                <td><input placeholder="xxx" id="c" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>leaky_re_lu_1</td>
                                <td><input placeholder="xxx" id="d" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>max_pooling1d</td>
                                <td><input placeholder="xxx" id="e" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>dropout</td>
                                <td><input placeholder="xxx" id="f" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>conv1d_2</td>
                                <td><input placeholder="xxx" id="g" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>leaky_re_lu_2</td>
                                <td><input placeholder="xxx" id="h" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>global_average_pooling1d</td>
                                <td><input placeholder="xxx" id="i" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>dropout_1</td>
                                <td><input placeholder="xxx" id="j" type="text" class="validate" required></td>
                            </tr>
                            <tr>
                                <td>dense</td>
                                <td><input placeholder="xxx" id="k" type="text" class="validate" required></td>
                            </tr>
                        </tbody>
                    </table>
                    <br><br>
                    <div class="input-field col s12">
                        <i class="material-icons prefix">vpn_key</i>
                        <input placeholder="xxx" type="text" class="validate" required id="_">
                        <label for="pwd">證書金鑰</label>
                    </div>
                    
                    <button class="btn waves-effect right" type="submit">
                        產生證書
                        <i class="material-icons right">send</i>
                    </button>
                </div>
            </form>
        </div>

        
    </main>

    <div id="second">

    </div>

    <footer class="page-footer teal darken-1">
        <span class="center-align">&copy; Copyright 2022 Yutech Corp. by myku. All right reserved.</span>
    </footer>

    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="./lib/materialize/js/materialize.min.js"></script>

    <script type="text/javascript">
        // for materialize
        M.AutoInit();
    </script>



    <script type="text/javascript">
        /**
         * @param  {string}          tagName   tag name
         * @param  {string|string[]} classList class list
         * @param  {string}          innerHtml innerHTML
         * @param  {JsonObject}      attrs     attr-*
         * @return {HTMLElement}
         */
        const simpleCreateHTML = (tagName, classList, innerHTML, attrs) => {
            const check = x => x!==void(0) && x!==null;

            if(!check(tagName)) throw Error('No tag name...');

            const node = document.createElement(tagName);

            if(check(classList)) node.classList.add(...classList);
            
            if(check(innerHTML)) node.innerHTML = innerHTML;
            
            if(check(attrs)) Object.keys(attrs).forEach(attr => node.setAttribute(attr, attrs[attr]));
            
            return node;
        };

        class Controller {
            constructor() {
                this.dirty = null;
                this.today = null;

                this._ = ''; // pwd
                this._a = ''; // name
                this._b = ''; // birthday
                this._c = null; // file
                this._d = null; // file 
                this._e = null; // file
                this._f = null;

                // table
                this.a = '';
                this.b = '';
                this.c = '';
                this.d = '';
                this.e = '';
                this.f = '';
                this.g = '';
                this.h = '';
                this.i = '';
                this.j = '';
                this.k = '';
                this.l = '';
                this.m = '';
                this.n = '';
                this.o = '';
                this.p = '';
            }
            init(mainNode, secondNode) {
                const self = this;
                mainNode.classList.add('main');
                secondNode.classList.add('second');

                this.refreshCertificate();
                this.createListener();

                window.onafterprint = function() {
                    self.refreshCertificate();
                };
            }
            createElementByInner(str) {
                const div = document.createElement('div');
                div.innerHTML = str;
                const container = document.createDocumentFragment();
                div.childNodes.forEach(childNode => {
                    const node = childNode.cloneNode(true);
                    container.appendChild(node);
                });
                return container.childNodes;
            }
            removeElementRecursive(node) {
                while (node.firstElementChild) { 
                    node.firstElementChild.remove();             
                }
            }
            createListener() {
                const self = this;

                document.querySelectorAll('input[type="text"]').forEach(HTMLEle => {
                    HTMLEle.addEventListener('input', function(evt) {
                        if(
                            this.id === '_'   ||
                            this.id === '_a'  ||
                            this.id === 'a'   ||
                            this.id === 'b'   ||
                            this.id === 'c'   ||
                            this.id === 'd'   ||
                            this.id === 'e'   ||
                            this.id === 'f'   ||
                            this.id === 'g'   ||
                            this.id === 'h'   ||
                            this.id === 'i'   ||
                            this.id === 'j'   ||
                            this.id === 'k'   ||
                            this.id === 'l'   ||
                            this.id === 'm'   ||
                            this.id === 'n'   ||
                            this.id === 'o'   ||
                            this.id === 'p'    
                        ) {
                            self[this.id] = this.value;
                        } else console.log(`Cannot figure out input/text of ${this.id}.`);
                    });
                });

                document.querySelectorAll('input[type="file"]').forEach(HTMLEle => {
                    HTMLEle.addEventListener('input', function(evt) {
                        if (this.files && this.files[0]) {
                            if(
                                this.id === '_c'   ||
                                this.id === '_d'   ||
                                this.id === '_e'   || 
                                this.id === '_f'
                            ) {
                                self.refreshCertificate() // avoid intent print
                                self[this.id] = URL.createObjectURL(this.files[0]);
                                const pic = document.querySelector(`#${this.id}_pic`);
                                const blobURL = self[this.id]; // set src to blob url
                                pic.style = 'width: auto; height: 60px;';
                                pic.src = blobURL;
                                // pic.onload = () => URL.revokeObjectURL(blobURL); // no longer needed, free memory
                            } else console.log(`Cannot figure out input/file of ${this.id}.`);
                        }
                    });
                });

                document.querySelectorAll('input[type="date"]').forEach(HTMLEle => {
                    HTMLEle.addEventListener('input', function(evt) {
                        switch(this.id) {
                            case '_b': {
                                console.log(this.value);
                                self[this.id] = this.value.replace(/-/g, '/');
                                break;
                            }
                            
                        default:
                            console.log(`Cannot figure out input/date of ${this.id}.`);
                        }
                            
                        
                    });
                });

                document.getElementById('genCert').addEventListener('submit', function(evt) {
                    /* refresh */
                    self.refreshCertificate();
                    evt.preventDefault();


                    self.today = new Date().today();
                    
                    /* page 1 */
                    const certificate1 = document.getElementById('certificate1');
                    certificate1.appendChild(simpleCreateHTML('div', ['certificate___a--1'], self._a));


                    const today = simpleCreateHTML('div', ['certificate__date']);
                    today.appendChild(simpleCreateHTML('div', ['certificate__date--yy'], self.today.yy));
                    today.appendChild(simpleCreateHTML('div', ['certificate__date--mm'], self.today.mm));
                    today.appendChild(simpleCreateHTML('div', ['certificate__date--dd'], self.today.dd));
                    certificate1.appendChild(today);

                    /* page 2 */
                    const certificate2 = document.getElementById('certificate2');
                    certificate2.appendChild(simpleCreateHTML('div', ['certificate___a--2'], self._a));
                    certificate2.appendChild(simpleCreateHTML('div', ['certificate__date---b'], self._b));
                    certificate2.appendChild(simpleCreateHTML('div', ['certificate__date--today'], `${self.today.yy}/${self.today.mm}/${self.today.dd}`));

                    const _c = simpleCreateHTML('img', ['certificate___c']);
                    _c.src = self._c;
                    certificate2.appendChild(_c);

                    const _d = simpleCreateHTML('img', ['certificate___d']);
                    _d.src = self._d;
                    certificate2.appendChild(_d);

                    const _e = simpleCreateHTML('img', ['certificate___e']);
                    _e.src = self._e;
                    certificate2.appendChild(_e);

                    const _f = simpleCreateHTML('img', ['certificate___f']);
                    _f.src = self._f;
                    certificate2.appendChild(_f);


                   
                    

                    const table = self.createElementByInner(`
                        <table class="certificate__table">
                            <thead>
                                <tr>
                                    <th>Layer</th>
                                    <th>Output shape</th>
                                </tr>
                            </thead>
                    
                            <tbody>
                                <tr>
                                    <td>conv1d</td>
                                    <td class="certificate__table--a">${self.a}</td>
                                </tr>
                                <tr>
                                    <td>leaky_re_lu</td>
                                    <td class="certificate__table--b">${self.b}</td>
                                </tr>
                                <tr>
                                    <td>conv1d_1</td>
                                    <td class="certificate__table--c">${self.c}</td>
                                </tr>
                                <tr>
                                    <td>leaky_re_lu_1</td>
                                    <td class="certificate__table--d">${self.d}</td>
                                </tr>
                                <tr>
                                    <td>max_pooling1d</td>
                                    <td class="certificate__table--e">${self.e}</td>
                                </tr>
                                <tr>
                                    <td>dropout</td>
                                    <td class="certificate__table--f">${self.f}</td>
                                </tr>
                                <tr>
                                    <td>conv1d_2</td>
                                    <td class="certificate__table--g">${self.g}</td>
                                </tr>
                                <tr>
                                    <td>leaky_re_lu_2</td>
                                    <td class="certificate__table--h">${self.h}</td>
                                </tr>
                                <tr>
                                    <td>global_average_pooling1d</td>
                                    <td class="certificate__table--i">${self.i}</td>
                                </tr>
                                <tr>
                                    <td>dropout_1</td>
                                    <td class="certificate__table--j">${self.j}</td>
                                </tr>
                                <tr>
                                    <td>dense</td>
                                    <td class="certificate__table--k">${self.k}</td>
                                </tr>
                            </tbody>
                        </table>



                    `);

                    certificate2.append(...table);

                    // const node = document.getElementById('table').cloneNode(true);
                    // certificate2.appendChild(node);

                    if(self._ === 'yutech') {
                        self.dirty.destroy();
                        window.print();
                    } else {
                        self.refreshCertificate();
                        alert('密碼錯誤!!!');
                    }
                    
                });
            }


            createCertificate(pages) {
                return pages.map(page => {
                    const certificate = simpleCreateHTML('section', ['certificate']);
                    certificate.id = `certificate${page}`;
            
                    const certificateImageBg = simpleCreateHTML('img', ['certificate__image--bg', 'browser-default']);
                    certificateImageBg.src=`./img/pg${page}${(page===1)? '_lab5' : ''}.jpg`;
                    certificateImageBg.alt=`Certificate${page}`;
            
                    certificate.appendChild(certificateImageBg);
                    return certificate; // aware of return certificate.appendChild(certificateImageBg); will error
                });
            }

            refreshCertificate() {
                const secondNode = document.getElementById('second');
                secondNode.innerHTML = '';

                this.createCertificate([1, 2]).forEach(page => secondNode.appendChild(page));

                // re-gen
                this.dirty = M.Datepicker.init(document.querySelector(".datepicker"), {
                    format: 'yyyy/mm/dd',
                    onClose: function() {
                        controller._b = this.toString();
                    }
                });
            }
        }


        const controller = new Controller();
        controller.init(
            document.getElementById('main'), 
            document.getElementById('second'), 
        );























        Date.prototype.today = function() {
            return {
                yy: this.getFullYear(),
                mm: (this.getMonth()+1 < 10)? `0${this.getMonth()+1}` : `${this.getMonth()+1}`,
                dd: (this.getDate() < 10)? `0${this.getDate()}` : `${this.getDate()}`
            };
        };
    </script>
</body>
</html>